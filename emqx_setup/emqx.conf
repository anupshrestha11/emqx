## EMQX Configuration for mTLS

# Node configuration
node {
  name = "emqx@127.0.0.1"
  cookie = "emqxsecretcookie"
  data_dir = "/opt/emqx/data"
}

# MQTT over SSL/TLS configuration
listeners.ssl.default {
  bind = "0.0.0.0:8883"
  ssl_options {
    cacertfile = "/opt/emqx/etc/certs/ca-cert.pem"
    certfile = "/opt/emqx/etc/certs/server-cert.pem"
    keyfile = "/opt/emqx/etc/certs/server-key.pem"
    verify = verify_peer
    fail_if_no_peer_cert = true
  }
}

# Regular MQTT listener (optional, can be disabled for mTLS only)
listeners.tcp.default {
  bind = "0.0.0.0:1883"
  enable = true
}

# Dashboard configuration
dashboard {
  listeners.http {
    bind = 18083
  }
  default_username = "admin"
  default_password = "public"
}

# Authentication settings
authentication = [
  {
    mechanism = x509
    use_identity_as_username = true
    backend = built_in_database
  }
]

# Authorization settings (basic configuration)
authorization {
  sources = [
    {
      type = built_in_database
    }
  ]
  no_match = allow
}
